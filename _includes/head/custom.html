<!-- FAVICONS -->
<link rel="icon" href="/images/favicon.ico" sizes="any">
<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<!-- Google Fonts (fast, readable, techy) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

<!-- Your brand overrides -->
<link rel="stylesheet" href="{{ '/assets/css/brand.css' | relative_url }}">

<!-- Prevent FOUC: apply saved theme ASAP -->
<script>
  (function() {
    try { if (localStorage.getItem('theme') === 'dark')
      document.documentElement.classList.add('theme-dark');
    } catch(e){}
  })();
</script>

<style>
  .author-me{ font-weight:800; color:#0e7490; }
  html.theme-dark .author-me{ color:#7dc9ff; }
  /* Bigger author avatar (desktop) + responsive fallback */
  .page__sidebar .author__avatar,
  .page__sidebar .author__avatar img{
    width: 240px !important;
    height: 240px !important;
  }
  @media (max-width: 540px){
    .page__sidebar .author__avatar,
    .page__sidebar .author__avatar img{
      width: 128px !important;
      height: 128px !important;
    }
  }

  /* === What's next slide-out + contact modal (tab + panel only, visual tokens) === */
  .wnx-tab{
    position:fixed; right:0; top:35vh; z-index:1000;
    transform:translateX(0);
    background:var(--mm-accent, #0ea5e9);
    color:#fff; border:none; border-radius:12px 0 0 12px;
    padding:.55rem .75rem; font-weight:900; letter-spacing:.02em;
    box-shadow:0 8px 16px rgba(0,0,0,.15);
  }
  .wnx-tab span{ writing-mode:vertical-rl; transform:rotate(180deg); }

  .wnx-panel{
    position:fixed; right:-360px; width:340px; bottom:24px; z-index:1000;
    /* top is set dynamically so it never clips behind the masthead */
    background:var(--mm-card-bg, #fff);
    border:1.5px solid var(--mm-border, #e5e7eb);
    border-radius:16px 0 0 16px;
    box-shadow:0 12px 24px rgba(0,0,0,.18);
    transition:right .18s ease;
    display:flex; flex-direction:column;
  }
  .wnx-panel.open{ right:0; }
  .wnx-head{
    display:flex; align-items:center; justify-content:space-between;
    padding:.7rem .8rem; font-weight:900; border-bottom:1px solid var(--mm-border, #e5e7eb);
  }
  .wnx-close{ border:none; background:transparent; font-size:1.1rem; line-height:1; color:inherit; cursor:pointer; }
  .wnx-body{ overflow:auto; padding:.6rem .8rem; }
  .wnx-list{ display:flex; flex-direction:column; gap:.75rem; }
  .wnx-card{
    background:var(--mm-card-bg, #fff);
    border:1px solid var(--mm-border, #e5e7eb);
    border-radius:14px; padding:12px 14px; box-shadow:0 6px 14px rgba(0,0,0,.08);
  }
  /* the slim blue bullet you liked */
  .wnx-title{ font-weight:900; margin:0 0 4px; display:flex; gap:.5rem; align-items:flex-start; }
  .wnx-title::before{ content:""; width:3px; height:14px; border-radius:2px; background:#0ea5e9; margin-top:3px; }
  .wnx-meta{ color:#64748b; font-weight:700; font-size:.95rem; }

  /* Floating contact button stays bottom-right; theme toggle will be in masthead */
  .contact-fab{
    position:fixed; right:16px; bottom:16px; z-index:999; /* lower than masthead controls */
    width:56px; height:56px; border-radius:999px; border:none; cursor:pointer;
    box-shadow:0 12px 22px rgba(0,0,0,.18);
    background:var(--mm-accent, #0ea5e9); color:#fff; font-size:22px;
  }
  html.theme-dark .contact-fab{ box-shadow:none; }

  /* Mobile: turn panel into a bottom sheet */
  @media (max-width:1100px){
    .wnx-tab{ top:auto; bottom:90px; right:14px; border-radius:999px; padding:.55rem .7rem; }
    .wnx-tab span{ writing-mode:horizontal-tb; transform:none; }
    .wnx-panel{
      right:14px; left:14px; width:auto; bottom:90px; top:auto; border-radius:16px;
      transform:translateY(110%); transition:transform .18s ease;
    }
    .wnx-panel.open{ transform:translateY(0); right:14px; }
  }
</style>

<!-- Brand tokens, dark-mode styling, sticky header, pills, callout -->
<style>
  :root{
    --brand-accent:#0ea5e9;

    /* dark tokens */
    --dark-bg:#0d1117; --dark-text:#e6edf3; --dark-heading:#f3f4f6;
    --dark-link:#58a6ff; --dark-link-hov:#8ab4ff;
    --dark-panel:#0b1220; --dark-panel-brdr:#1f2937;

    /* footer in dark */
    --dark-footer-bg:#0B2738; --dark-footer-text:#9ec1d9;
    --dark-footer-link:#58a6ff; --dark-footer-brdr:#0f3a52;
  }

  /* subtle brand line */
  .masthead{ border-bottom:4px solid var(--brand-accent); }

  /* sticky masthead â€” solid background (no glass), readable in both themes */
  .masthead{ position:sticky; top:0; z-index:2000; background:#ffffff; }
  .greedy-nav{ background:inherit; }              /* keep nav same as masthead */
  .greedy-nav a, .site-title{ color:#0f172a; }    /* readable links in light */

  /* tiny shadow only after scrolling a bit */
  .masthead.is-stuck{ box-shadow:0 2px 6px rgba(0,0,0,.06); }

  <style>
  .masthead__inner-wrap { padding-block: 10px; }

  .site-title {
    display: inline-flex; align-items: center; gap: .5rem;
    text-decoration: none;
  }
  .site-logo img { height: 22px; width: auto; display: block; }

  .brand-text {
    font-weight: 800; font-size: 1.06rem; letter-spacing: .2px;
    color: var(--mm-text, #0b1320);
  }

  /* tagline chip */
  .brand-sub {
    display: inline-flex; align-items: center;
    padding: .18rem .5rem; margin-left: .15rem;
    border-radius: 999px; font-weight: 700; font-size: .72rem;
    color: #0b3a46; background: #eaf6f8; border: 1px solid #cfe9ee;
    white-space: nowrap;
  }
  
  @media (max-width: 820px){ .brand-sub { display: none; } }

  /* subtle header underline tweak */
  .greedy-nav { border-bottom: 2px solid #52b3cf20; }

  /* Make the masthead logo readable in dark mode */
  html.theme-dark .site-logo img{
  filter: invert(1) hue-rotate(180deg) saturate(.8) brightness(.95);
  }
  
  /* dark mode */
  html.theme-dark .brand-text { color: #e6edf3; }
  html.theme-dark .brand-sub { color:#cce9ef; background:#0d2a31; border-color:#1f5b68; }

  /* dark theme header */
  html.theme-dark .masthead,
  html.theme-dark .greedy-nav{ background:var(--dark-bg) !important; }
  html.theme-dark .greedy-nav a,
  html.theme-dark .site-title{ color:var(--dark-text) !important; }
  html.theme-dark .masthead{ border-bottom-color:#22d3ee; }

  /* body copy */
  .page__content p, .page__content li{ text-align:justify; text-justify:inter-word; }

  /* DARK MODE â€” sitewide */
  html.theme-dark, html.theme-dark body{ background:var(--dark-bg)!important; color:var(--dark-text)!important; }
  html.theme-dark .page, html.theme-dark .page__inner-wrap, html.theme-dark .page__content,
  html.theme-dark .sidebar, html.theme-dark .archive__item, html.theme-dark .archive__item-excerpt{
    background:transparent!important; color:var(--dark-text)!important;
  }
  html.theme-dark h1, html.theme-dark h2, html.theme-dark h3, html.theme-dark h4,
  html.theme-dark h5, html.theme-dark h6, html.theme-dark .page__title{ color:var(--dark-heading)!important; }
  html.theme-dark a{ color:var(--dark-link)!important; }
  html.theme-dark a:hover{ color:var(--dark-link-hov)!important; }

  html.theme-dark pre, html.theme-dark code, html.theme-dark .highlighter-rouge{
    background:var(--dark-panel)!important; color:var(--dark-text)!important; border-color:var(--dark-panel-brdr)!important;
  }
  html.theme-dark .notice, html.theme-dark .toc, html.theme-dark .btn, html.theme-dark .btn--primary{
    background:#0f172a!important; color:var(--dark-text)!important; border-color:var(--brand-accent)!important;
  }

  /* footer overrides in dark */
  html.theme-dark .page__footer{
    background:var(--dark-footer-bg)!important; color:var(--dark-footer-text)!important;
    border-top:1px solid var(--dark-footer-brdr)!important;
  }
  html.theme-dark .page__footer a, html.theme-dark .page__footer .fa, html.theme-dark .page__footer .fab{
    color:var(--dark-footer-link)!important;
  }

  /* author/meta icons brighter in dark */
  html.theme-dark .author__urls i, html.theme-dark .social-icons .fa, html.theme-dark .page__meta .fa{ color:#9ecbff!important; }

  /* search inputs in dark */
  html.theme-dark input[type="search"], html.theme-dark .search-input,
  html.theme-dark .search-content__input, html.theme-dark .search-content input{
    background:var(--dark-panel)!important; color:var(--dark-text)!important; border-color:var(--dark-panel-brdr)!important;
  }
  html.theme-dark ::placeholder{ color:#9aa4b2!important; opacity:1!important; }
</style>

<style>
  /* Dark-mode fixes for the mobile nav (greedy-nav hidden links) */
  html.theme-dark .greedy-nav .hidden-links{
    background:#0b1220;                /* dark panel */
    border:1px solid #374151;          /* subtle border */
    box-shadow:0 12px 24px rgba(0,0,0,.35);
  }
  html.theme-dark .greedy-nav .hidden-links:before{ /* little caret */
    border-color:transparent transparent #374151 transparent;
  }
  html.theme-dark .greedy-nav .hidden-links li{
    border-color:#374151;              /* item separators */
  }
  html.theme-dark .greedy-nav .hidden-links a{
    color:#e5e7eb !important;          /* readable links */
  }
  html.theme-dark .greedy-nav .hidden-links a:hover{
    background:#1f2937;
    color:#fff !important;
  }
  
  /* Make the toggle and visible links readable too */
  html.theme-dark .greedy-nav__toggle,
  html.theme-dark .greedy-nav a,
  html.theme-dark .masthead a.site-title {
    color:#e5e7eb;
  }
  html.theme-dark .greedy-nav__toggle:hover{ background:#1f2937; }
</style>

<script>
/* Solid sticky masthead with shadow after scroll */
(function(){
  var h = document.querySelector('.masthead');
  if(!h) return;
  var on = () => h.classList.toggle('is-stuck', window.scrollY > 8);
  on(); window.addEventListener('scroll', on, {passive:true});
})();

/* Copy BibTeX pill */
document.addEventListener('click', e=>{
  const b = e.target.closest('.pill--copy');
  if(!b) return;
  const txt = b.dataset.bib || '';
  navigator.clipboard.writeText(txt).then(()=>{
    b.dataset.label = b.textContent;
    b.textContent = 'Copied!';
    setTimeout(()=>{ b.textContent = b.dataset.label || 'BibTeX'; }, 900);
  });
});

/* === THEME TOGGLE (masthead) ============================================== */
(function(){
  // create once and park it in the masthead near the search icon
  const btn = document.createElement('button');
  btn.id = 'theme-toggle';
  btn.type = 'button';
  btn.style.cssText = 'border:1px solid transparent;background:transparent;color:currentColor;border-radius:999px;padding:.25rem .45rem;margin-left:.4rem;line-height:1;cursor:pointer;';
  const setIcon = () => btn.textContent = document.documentElement.classList.contains('theme-dark') ? 'â˜€ï¸' : 'ðŸŒ™';
  setIcon();
  btn.addEventListener('click', ()=>{
    const dark = document.documentElement.classList.toggle('theme-dark');
    try { localStorage.setItem('theme', dark ? 'dark' : 'light'); } catch(e){}
    setIcon();
  });

  /* Bubble button look when the toggle sits in the masthead */
  .masthead #theme-toggle{
    position: static !important;     /* override any old fixed rule */
    display:inline-flex; align-items:center; justify-content:center;
    width:34px; height:34px; border-radius:999px;
    margin-left:.5rem; font-size:18px; line-height:1;
    border:1px solid rgba(0,0,0,.12);
    background:#0e7490; color:#fff;
    box-shadow:0 3px 10px rgba(0,0,0,.12);
  }
  html.theme-dark .masthead #theme-toggle{
    background:#0b1220; color:#e6edf3; border-color:#263244;
    box-shadow:0 3px 10px rgba(0,0,0,.35);
  }

  function place(){
    const nav = document.querySelector('.masthead .greedy-nav');
    if(!nav) return false;
    const search = nav.querySelector('.search__toggle') || nav.querySelector('.site-search');
    if (search && search.parentNode) { search.parentNode.insertBefore(btn, search.nextSibling); return true; }
    const links = nav.querySelector('.visible-links') || nav;
    links.appendChild(btn); return true;
  }
  if (!place()) window.addEventListener('load', place);
})();
</script>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-351QZEBS4T"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date()); gtag('config', 'G-351QZEBS4T');
</script>
