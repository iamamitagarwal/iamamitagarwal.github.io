<!-- FAVICONS -->
<link rel="icon" href="/images/favicon.ico" sizes="any">
<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">

<!-- Prevent FOUC: apply saved theme ASAP -->
<script>
  (function () {
    try {
      if (localStorage.getItem('theme') === 'dark') {
        document.documentElement.classList.add('theme-dark');
      }
    } catch (e) {}
  })();
</script>

<!-- Brand tokens, dark-mode styling, sticky header, pills, and callouts -->
<style>
  :root{
    --brand-accent: #0ea5e9;

    /* dark tokens */
    --dark-bg:            #0d1117;
    --dark-text:          #e6edf3;
    --dark-heading:       #f3f4f6;
    --dark-link:          #58a6ff;
    --dark-link-hov:      #8ab4ff;
    --dark-panel:         #0b1220;
    --dark-panel-brdr:    #1f2937;

    /* footer in dark */
    --dark-footer-bg:     #0B2738;
    --dark-footer-text:   #9ec1d9;
    --dark-footer-link:   #58a6ff;
    --dark-footer-brdr:   #0f3a52;
  }

  /* ===== Sticky masthead (no overlap), readable in both themes ===== */
  .masthead{
    position: sticky;
    top: 0;
    z-index: 1050;
    background: rgba(255,255,255,.96);               /* light base */
    border-bottom: 4px solid var(--brand-accent);
    box-shadow: 0 1px 0 rgba(0,0,0,.06);
    backdrop-filter: saturate(160%) blur(8px);
    -webkit-backdrop-filter: saturate(160%) blur(8px);
  }
  html.theme-dark .masthead{
    background: rgba(13,17,23,.90) !important;       /* dark base */
    border-bottom-color: #22d3ee;
    box-shadow: 0 1px 0 rgba(255,255,255,.05);
  }

  /* Optional “glassier” look after a tiny scroll */
  .masthead.header-glass{
    background: rgba(255,255,255,.86);
  }
  html.theme-dark .masthead.header-glass{
    background: rgba(13,17,23,.84) !important;
  }

  /* Make anchor jumps land below the sticky bar */
  :where(h1,h2,h3,h4,h5,h6){ scroll-margin-top: 88px; }

  /* Body copy */
  .page__content p,
  .page__content li{ text-align: justify; text-justify: inter-word; }

  /* ===== Dark mode: sitewide ===== */
  html.theme-dark,
  html.theme-dark body{ background: var(--dark-bg) !important; color: var(--dark-text) !important; }

  html.theme-dark .page,
  html.theme-dark .page__inner-wrap,
  html.theme-dark .page__content,
  html.theme-dark .sidebar,
  html.theme-dark .archive__item,
  html.theme-dark .archive__item-excerpt{
    background: transparent !important;
    color: var(--dark-text) !important;
  }

  html.theme-dark h1,
  html.theme-dark h2,
  html.theme-dark h3,
  html.theme-dark h4,
  html.theme-dark h5,
  html.theme-dark h6,
  html.theme-dark .page__title{ color: var(--dark-heading) !important; }

  html.theme-dark a{ color: var(--dark-link) !important; }
  html.theme-dark a:hover{ color: var(--dark-link-hov) !important; }

  html.theme-dark .greedy-nav a,
  html.theme-dark .site-title{ color: var(--dark-text) !important; }

  html.theme-dark pre,
  html.theme-dark code,
  html.theme-dark .highlighter-rouge{
    background: var(--dark-panel) !important;
    color: var(--dark-text) !important;
    border-color: var(--dark-panel-brdr) !important;
  }

  html.theme-dark .notice,
  html.theme-dark .toc,
  html.theme-dark .btn,
  html.theme-dark .btn--primary{
    background: #0f172a !important;
    color: var(--dark-text) !important;
    border-color: var(--brand-accent) !important;
  }

  /* Footer in dark */
  html.theme-dark .page__footer{
    background: var(--dark-footer-bg) !important;
    color: var(--dark-footer-text) !important;
    border-top: 1px solid var(--dark-footer-brdr) !important;
  }
  html.theme-dark .page__footer a,
  html.theme-dark .page__footer .fa,
  html.theme-dark .page__footer .fab{
    color: var(--dark-footer-link) !important;
  }

  /* Author/meta icons a bit brighter in dark */
  html.theme-dark .author__urls i,
  html.theme-dark .social-icons .fa,
  html.theme-dark .page__meta .fa{ color: #9ecbff !important; }

  /* Search inputs in dark */
  html.theme-dark input[type="search"],
  html.theme-dark .search-input,
  html.theme-dark .search-content__input,
  html.theme-dark .search-content input{
    background: var(--dark-panel) !important;
    color: var(--dark-text) !important;
    border-color: var(--dark-panel-brdr) !important;
  }
  html.theme-dark ::placeholder{ color:#9aa4b2 !important; opacity:1; }

  /* Theme toggle button (HTML lives in footer) */
  #theme-toggle{
    position: fixed; right: 16px; bottom: 16px; z-index: 9999;
    border: 0; padding: 10px 12px; border-radius: 999px;
    background: var(--dark-bg); color: #fff; cursor: pointer;
    box-shadow: 0 4px 14px rgba(0,0,0,.25);
  }
  html:not(.theme-dark) #theme-toggle{ background: #0e7490; }

  /* ===== About-page callout (restores thin accent rule) ===== */
  .about-callout{
    background: #e8f4fb;
    border: 1px solid #bcdcff;
    border-left: 4px solid #22a2cf;          /* accent line (light) */
    border-radius: .5rem;
  }
  html.theme-dark .about-callout{
    background: #0f2d3a !important;
    border: 1px solid #1f6b8f !important;
    border-left-color: #1f6b8f;              /* accent line (dark) */
    color: var(--dark-text) !important;
  }
  html.theme-dark .about-callout strong{ color: #fff !important; }
  html.theme-dark .about-callout em{ color: #cfe8ff !important; }
  html.theme-dark .about-callout a{ color: #7dc9ff !important; }
  html.theme-dark .about-callout:before{ color: #7dc9ff !important; opacity: 1 !important; }

  /* ===== Publication/Patent pills ===== */
  .link-pills{ display:flex; flex-wrap:wrap; gap:.5rem; margin:.4rem 0 0; }
  .link-pill{
    display:inline-flex; align-items:center; gap:.4rem; padding:.25rem .7rem;
    border-radius:999px; font-weight:600; border:1px solid var(--brand-accent);
    text-decoration:none; background:transparent; transition:.15s ease;
  }
  .link-pill:hover{ background:var(--brand-accent); color:#fff; }
  .pill--pdf{  border-color:#ef4444; } .pill--pdf:hover{  background:#ef4444; }
  .pill--code{ border-color:#16a34a; } .pill--code:hover{ background:#16a34a; }
  .pill--uspto{border-color:#8b5cf6; } .pill--uspto:hover{background:#8b5cf6; }
  .pill--copy{ cursor:pointer; }

  /* List spacing + hover cards */
  .pub-item, .pat-item{ padding:.6rem .8rem; border-radius:.75rem; }
  .pub-item:hover, .pat-item:hover{ background:rgba(14,165,233,.08); }
  html.theme-dark .pub-item:hover,
  html.theme-dark .pat-item:hover{ background:#0b1220; }

  /* Year section spacing */
  .pub-list, .pat-list{ margin:.6rem 0 1.2rem; }
  .pub-list + h3, .pat-list + h3{
    border-top: 1px solid rgba(0,0,0,.06); padding-top: 1rem;
  }
  html.theme-dark .pub-list + h3,
  html.theme-dark .pat-list + h3{ border-color:#1f2937; }
</style>

<script>
/* Add subtle "glass" background to masthead after tiny scroll */
(function(){
  const h = document.querySelector('.masthead');
  if (!h) return;
  const onScroll = () => h.classList.toggle('header-glass', window.scrollY > 8);
  onScroll();
  window.addEventListener('scroll', onScroll, { passive: true });
})();

/* Copy BibTeX pill handler */
document.addEventListener('click', e => {
  const b = e.target.closest('.pill--copy');
  if (!b) return;
  const txt = b.dataset.bib || '';
  navigator.clipboard.writeText(txt).then(() => {
    const prev = b.textContent;
    b.textContent = 'Copied!';
    setTimeout(() => { b.textContent = prev || 'BibTeX'; }, 900);
  });
});
</script>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-351QZEBS4T"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-351QZEBS4T');
</script>
