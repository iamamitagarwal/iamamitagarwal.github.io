{%- comment -%} Theme toggle + widgets injected site-wide {%- endcomment -%}
<style>
  /* (kept) If toggle has to float, offset it so it doesn't sit on top of the contact FAB */
  #theme-toggle.floating{ right:72px !important; bottom:16px !important; z-index:9999; }
</style>

<script>
(function(){
  // Apply saved theme very early
  try {
    var saved = localStorage.getItem('theme');
    if (saved === 'dark') document.documentElement.classList.add('theme-dark');
  } catch(e){}

  // Create/reuse button
  var existing = document.getElementById('theme-toggle');
  var btn = existing || document.createElement('button');
  btn.id = 'theme-toggle';
  btn.type = 'button';
  btn.setAttribute('aria-label','Toggle theme');
  btn.setAttribute('title','Toggle theme');
  var setIcon = function(){
    btn.textContent = document.documentElement.classList.contains('theme-dark') ? '‚òÄÔ∏è' : 'üåô';
  };
  setIcon();

  btn.addEventListener('click', function(){
    var dark = document.documentElement.classList.toggle('theme-dark');
    try { localStorage.setItem('theme', dark ? 'dark' : 'light'); } catch(e){}
    setIcon();
  });

  function tryPlace(){
    var greedy = document.querySelector('.masthead .greedy-nav');
    if (!greedy) return false;
    var search = greedy.querySelector('.search__toggle') || greedy.querySelector('.site-search');
    if (search && search.parentNode) { search.parentNode.insertBefore(btn, search.nextSibling); return true; }
    var links = greedy.querySelector('.visible-links') || greedy;
    if (links) { links.appendChild(btn); return true; }
    return false;
  }

  if (!tryPlace()) {
    btn.classList.add('floating');
    document.body.appendChild(btn);
    window.addEventListener('load', function(){
      if (tryPlace()) btn.classList.remove('floating');
    });
  }
})();
</script>

{%- comment -%} Inject the ‚ÄúWhat‚Äôs next‚Äù + Contact widgets everywhere {%- endcomment -%}
{% include whatsnext_and_contact.html %}
