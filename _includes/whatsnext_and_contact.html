<style>
  /* ---------- “What’s next” bulletin ---------- */
  .whatsnext-wrap{
    position:fixed; top:88px; right:16px; width:320px; z-index:800;
    display:flex; flex-direction:column; gap:.6rem;
  }
  .whatsnext-card{
    background:var(--wn-bg,#fff); border:1px solid var(--wn-border,#e5e7eb);
    border-radius:16px; box-shadow:0 8px 22px rgba(0,0,0,.08);
  }
  .whatsnext-head{
    display:flex; align-items:center; justify-content:space-between;
    padding:.8rem 1rem .6rem; border-bottom:1px solid var(--wn-border,#e5e7eb);
  }
  .whatsnext-title{ font-weight:800; font-size:1.15rem; }
  .wn-list{ list-style:none; margin:0; padding:1rem; display:flex; flex-direction:column; gap:.75rem; }
  .wn-item{ background:var(--wn-tile,#fff); border:1px solid var(--wn-border,#e5e7eb);
           border-radius:12px; padding:.9rem 1rem; }
  .wn-item h4{ margin:.1rem 0 .25rem; font-size:1.05rem; }
  .wn-item p{ margin:0; color:var(--wn-muted,#4b5563); }
  .wn-dot{ display:inline-block; width:7px; height:10px; border-radius:3px; margin-right:.35rem;
           background:linear-gradient(180deg,#3b82f6,#22c55e); vertical-align:baseline; }

  /* collapsed state */
  .whatsnext-card[data-collapsed="true"] .wn-list{ display:none; }
  .whatsnext-card[data-collapsed="true"] .wn-toggle::after{ content:"Expand"; }
  .wn-toggle{ border:1px solid #cbd5e1; background:#f8fafc; border-radius:10px; padding:.25rem .6rem; cursor:pointer; }
  .wn-toggle::after{ content:"Collapse"; }

  html.theme-dark .whatsnext-card{ --wn-bg:#0b1220; --wn-border:#1f2937; }
  html.theme-dark .wn-item{ --wn-tile:#0b1220; --wn-border:#1f2937; }
  html.theme-dark .wn-item p{ --wn-muted:#9ca3af; }

  /* ---------- Contact FAB + Drawer ---------- */
  .contact-fab{
    position:fixed; right:16px; bottom:16px; width:56px; height:56px; border-radius:50%;
    background:#0ea5e9; color:#fff; display:grid; place-items:center; font-size:22px;
    box-shadow:0 10px 24px rgba(2,132,199,.35); z-index:950; cursor:pointer;
  }
  .contact-drawer{
    position:fixed; top:0; right:0; width:360px; max-width:90vw; height:100vh; z-index:940;
    transform:translateX(100%); transition:transform .22s ease;
    background:var(--cd-bg,#fff); border-left:1px solid var(--cd-border,#e5e7eb);
    box-shadow:-12px 0 30px rgba(0,0,0,.18);
    display:flex; flex-direction:column;
  }
  .contact-drawer.open{ transform:none; }
  .cd-head{ display:flex; align-items:center; justify-content:space-between; padding:.9rem 1rem; border-bottom:1px solid var(--cd-border,#e5e7eb); }
  .cd-body{ padding:1rem; gap:.75rem; display:flex; flex-direction:column; }
  .cd-body label{ font-weight:700; font-size:.9rem; }
  .cd-body input,.cd-body textarea{
    width:100%; border:1px solid var(--cd-field,#cbd5e1); border-radius:10px; padding:.55rem .7rem; font:inherit;
    background:var(--cd-input-bg,#fff); color:inherit;
  }
  .cd-body textarea{ min-height:120px; resize:vertical; }
  .cd-actions{ display:flex; justify-content:flex-end; gap:.5rem; padding:0 1rem 1rem; }
  .cd-btn{ border:1px solid #cbd5e1; border-radius:10px; padding:.45rem .8rem; background:#f8fafc; cursor:pointer; }
  .cd-btn--primary{ background:#22c55e; border-color:#22c55e; color:#fff; }

  html.theme-dark .contact-drawer{ --cd-bg:#0b1220; --cd-border:#1f2937; --cd-field:#334155; --cd-input-bg:#0b1220; }
  @media (max-width: 1024px){
    .whatsnext-wrap{ position:static; width:auto; margin:1rem 0; }
  }
</style>

<div class="whatsnext-wrap">
  <div class="whatsnext-card" id="wn-card" data-collapsed="true">
    <div class="whatsnext-head">
      <div class="whatsnext-title">What’s next</div>
      <button type="button" class="wn-toggle" id="wn-toggle"></button>
    </div>
    <ul class="wn-list">
      {%- assign items = site.data.whats_next | default: site.data.whatsnext -%}
      {%- for it in items -%}
        <li class="wn-item">
          <h4><span class="wn-dot"></span>
            {%- if it.link and it.link != "" -%}
              <a href="{{ it.link }}" target="_blank" rel="noopener">{{ it.title }}</a>
            {%- else -%}
              {{ it.title }}
            {%- endif -%}
          </h4>
          {%- if it.desc and it.desc != "" -%}<p>{{ it.desc }}</p>{%- endif -%}
          {%- if it.when or it.tag -%}
            <p style="font-size:.85rem; opacity:.8">
              {%- if it.tag -%}<em>{{ it.tag }}</em>{% if it.when %} • {% endif %}{%- endif -%}
              {%- if it.when -%}{{ it.when }}{%- endif -%}
            </p>
          {%- endif -%}
        </li>
      {%- endfor -%}
    </ul>
  </div>
</div>

<button class="contact-fab" id="contact-fab" aria-label="Open contact">✉️</button>
<div class="contact-drawer" id="contact-drawer" aria-hidden="true">
  <div class="cd-head">
    <strong>Say hello</strong>
    <button class="cd-btn" id="cd-close" aria-label="Close">Close</button>
  </div>
  <form class="cd-body" action="https://formspree.io/f/mwpydbpb" method="POST">
    <label for="cd-name">Name</label>
    <input id="cd-name" name="name" type="text" autocomplete="name" />
    <label for="cd-email">Email</label>
    <input id="cd-email" name="email" type="email" autocomplete="email" required />
    <label for="cd-subj">Subject</label>
    <input id="cd-subj" name="subject" type="text" />
    <label for="cd-msg">Message</label>
    <textarea id="cd-msg" name="message" required></textarea>
    <div class="cd-actions">
      <button type="button" class="cd-btn" id="cd-cancel">Cancel</button>
      <button type="submit" class="cd-btn cd-btn--primary">Send</button>
    </div>
  </form>
</div>

<script>
(function(){
  /* “What’s next” collapse */
  var card = document.getElementById('wn-card');
  var tog  = document.getElementById('wn-toggle');
  if (card && tog){
    tog.addEventListener('click', function(){
      var c = card.getAttribute('data-collapsed') === 'true';
      card.setAttribute('data-collapsed', c ? 'false' : 'true');
      try { localStorage.setItem('wn-collapsed', card.getAttribute('data-collapsed')); } catch(e){}
    });
    try {
      var saved = localStorage.getItem('wn-collapsed');
      if (saved) card.setAttribute('data-collapsed', saved);
    } catch(e){}
  }

  /* Contact drawer */
  var fab   = document.getElementById('contact-fab');
  var draw  = document.getElementById('contact-drawer');
  var close = document.getElementById('cd-close');
  var cancel= document.getElementById('cd-cancel');
  function open(){ draw.classList.add('open'); draw.setAttribute('aria-hidden','false'); }
  function shut(){ draw.classList.remove('open'); draw.setAttribute('aria-hidden','true'); }
  if (fab) fab.addEventListener('click', open);
  [close,cancel].forEach(function(b){ if (b) b.addEventListener('click', shut); });
})();
</script>
